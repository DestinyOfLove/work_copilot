# SCOPSR/SHBB文章保存器

一个通用油猴脚本，支持批量保存SCOPSR和SHBB两个网站的文章为DOCX格式文档。

## 功能特性

- ✅ **双站点支持**：SCOPSR (scopsr.gov.cn) 和 SHBB (shbb.gov.cn)
- ✅ **批量保存**：支持单页或多页文章批量保存
- ✅ **智能页码检测**：自动识别当前页和总页数
- ✅ **页码范围选择**：可指定保存的页数范围
- ✅ **格式保留**：
  - 段落结构完整保持
  - 标题居中格式
  - 列表编号格式
  - 正文缩进格式
- ✅ **DOCX格式输出**：生成标准Word文档
- ✅ **详细通知**：显示每篇文章的保存状态和文件名
- ✅ **跨域支持**：处理HTTP/HTTPS混合内容

## 技术特点

### DOCX格式支持
- 生成Word兼容的HTML格式，保存为.docx扩展名
- 完全兼容Word 2007及以上版本
- 支持WPS、LibreOffice等办公软件
- 文件可直接在Word中打开和编辑

### 格式保留
- 文档标题使用Word原生样式
- 完整保留原文的段落结构，不自动拆分
- 基于HTML/CSS属性智能识别标题和正文
- 保留原文中的段落和换行
- 中文排版优化（首行缩进、两端对齐）
- 每篇文章自动分页

## 安装使用

### 安装步骤
1. 安装[Tampermonkey](https://www.tampermonkey.net/)浏览器插件
2. 点击Tampermonkey图标，选择"创建新脚本"
3. 将`scopsr-shbb-article-saver.user.js`的内容复制粘贴进去
4. 保存脚本（Ctrl+S）

### 使用方法

#### 批量保存（搜索结果页）
1. 访问支持的搜索结果页面：
   - SCOPSR: `https://www.scopsr.gov.cn/was5/web/search`
   - SHBB: `https://www.shbb.gov.cn/search.jspx`
2. 页面右侧出现绿色"批量保存文章"按钮
3. 点击按钮，输入要保存的页数（从当前页开始）
4. 系统会提示：`当前第X页，可保存1-Y页，请输入要保存的页数`
5. 显示实时进度：`第X页: 处理 A/B (总成功:C 总失败:D)`
6. 自动下载生成的DOCX文件
7. 显示详细结果通知，包含：
   - 保存的文件名
   - 成功/失败的文章列表
   - 每篇文章的标题和所在页码

#### 单篇保存（文章详情页）
1. 访问文章详情页面：
   - SCOPSR: `https://www.scopsr.gov.cn/xwzx/xxxx.shtml`
   - SHBB: `https://www.shbb.gov.cn/xxx/xxx.jhtml`
2. 页面右侧出现"保存本文为DOCX"按钮
3. 点击保存当前文章

## 生成的文档

### 文档结构
```
封面
├── 标题：SCOPSR文章集
├── 生成日期
└── 文章数量统计

正文（每篇文章）
├── 文章标题（Heading 1）
├── 发布时间（灰色小字）
├── 来源链接（灰色小字）
└── 文章内容（格式化段落）
```

### 文件命名
- 单页保存：`搜索词_第X页_YYYY-MM-DD_HH-MM-SS.docx`
- 多页保存：`搜索词_第X页到第Y页_YYYY-MM-DD_HH-MM-SS.docx`
- 单篇保存：`文章标题_YYYY-MM-DD_HH-MM-SS.docx`
- 无搜索词时使用：`SCOPSR文章集_...`

## 支持的网站

### SCOPSR (scopsr.gov.cn)
- 搜索页面：`/was5/web/search`
- 文章页面：`/xwzx/*.shtml`
- 分页格式：URL参数 `?page=2`

### SHBB (shbb.gov.cn)
- 搜索页面：`/search.jspx`, `/search_2.jspx`
- 文章页面：`/*/*.jhtml`
- 分页格式：文件名递增 `search_2.jspx`

## 更新历史

### v4.9 (2025-01)
- 为SHBB网站增加视觉一致性处理
- 模拟CSS white-space: normal效果
- 保证下载文档与网页显示效果一致
- 在段落内将换行符转换为空格，保留段落间换行

### v4.8 (2025-01)
- 修复标题检测逻辑，基于HTML标签和CSS属性判断
- 完全保留原始格式，不再自动拆分段落
- 改进SHBB网站的段落和换行处理
- 使用font-family属性区分标题（黑体）和正文（仿宋）

### v4.4 (2025-01)
- 新增SHBB网站支持，实现双站点通用
- 智能段落格式识别和保留
- 改进内容提取，保持原文格式结构
- 增强调试功能，便于问题排查

### v4.0 (2025-01)
- 新增多页批量保存功能
- 智能检测当前页码和总页数
- 文件名显示页码范围
- 增强通知系统
- 优化UI界面

### v3.2 (2024-08)
- 修复批量保存时文章收集不全的问题
- 移除URL路径限制，支持所有栏目的文章
- 文件名精确到秒，避免重名
- 添加控制台日志，方便调试

### v3.1 (2024-08)
- 优化DOCX生成方式，提高稳定性
- 使用HTML兼容格式，确保更好的兼容性
- 保留每行换行，每行作为独立段落
- 移除外部库依赖，提高加载速度

### v1.1 (2024-08)
- 修复跨域请求问题
- 使用GM_xmlhttpRequest处理HTTP/HTTPS混合内容

### v1.0 (2024-08)
- 初始版本
- 支持JSON格式输出

## 技术实现

- **HTML兼容格式** - 生成Word兼容的HTML结构
- **MSO标签** - 使用Microsoft Office专用XML标签
- **GM_xmlhttpRequest** - 跨域请求处理
- **GM_download** - 文件下载管理

## 注意事项

1. 批量保存时会逐个获取文章内容，请耐心等待
2. 建议一次不要保存太多页面（建议少于10页，每页约10篇文章）
3. 生成的文件扩展名为`.docx`，可在Word中直接打开
4. 文档使用HTML兼容格式，确保最大兼容性
5. 每个换行都会保留为独立段落
6. 如果文章获取失败，会在文档中标记为红色提示
7. 系统会自动检测可用页数，防止请求超出范围的页面
8. 保存完成后会显示详细的成功/失败文章列表

## 问题反馈

如遇到问题，请查看浏览器控制台（F12）的错误信息。

## 许可证

MIT License